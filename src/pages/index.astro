---
import GlobalLayout from '@layouts/GlobalLayout.astro';
import TopLayout from '@layouts/TopLayout.astro';
import { JButtonList } from '@components/JButton';
import JInfoBox from '@components/JInfoBox.astro';

import { getCollection } from 'astro:content';
import { genVoice, uploadR2 } from 'src/lib/genVoice';

const allVoice = await getCollection('voice');

allVoice.forEach(async (voice) => {
  const data = voice.data;
  await genVoice(voice.slug, data.ytid, data.start, data.during);
  if (import.meta.env.PROD) {
    await uploadR2(voice.slug);
  }
});
---

<GlobalLayout>
  <TopLayout>
    <JButtonList buttonList={allVoice} client:load />
    <JInfoBox />
  </TopLayout>
</GlobalLayout>
